# tlsproxy (?) Konfiguration einstellen{{{

tlsproxy_conf() {

	# Variable
	TLSPROXY_TITLE="${gv_Configuration}::${lv_TlsProxy}"
	
	# Bestehende Konfiguration einlesen# {{{
	print -l ${(M)${(f)"$(postconf -c $MAIL_CONFIG)"}##(#s)tlsproxy_*} | \
		sed -e 's#\"#\\\"#g ; s# = #="#g ; s# =#="#g ;
		s#\$#\\\$#g ; s#$#"#g' >${gv_WorkDir}/postfix$$
	read_file -f ${gv_WorkDir}/postfix$$
	rm -rf  ${gv_WorkDir}/postfix$$ &>/dev/null
	## }}}
	# Funktion (conf_tlsproxy_menu), die tlsproxy-Parameter einstellen# {{{
	##############################################
	# TODO: Hilfe etc. vorbereitet
	# tlsproxy_enforce_tls = $smtpd_enforce_tls
	# tlsproxy_tls_CAfile = $smtpd_tls_CAfile
	# tlsproxy_tls_CApath = $smtpd_tls_CApath
	# tlsproxy_tls_always_issue_session_ids = $smtpd_tls_always_issue_session_ids
	# tlsproxy_tls_ask_ccert = $smtpd_tls_ask_ccert
	# tlsproxy_tls_ccert_verifydepth = $smtpd_tls_ccert_verifydepth
	# tlsproxy_tls_cert_file = $smtpd_tls_cert_file
	# tlsproxy_tls_ciphers = $smtpd_tls_ciphers
	# tlsproxy_tls_dcert_file = $smtpd_tls_dcert_file
	# tlsproxy_tls_dh1024_param_file = $smtpd_tls_dh1024_param_file
	# tlsproxy_tls_dh512_param_file = $smtpd_tls_dh512_param_file
	# tlsproxy_tls_dkey_file = $smtpd_tls_dkey_file
	# tlsproxy_tls_eccert_file = $smtpd_tls_eccert_file
	# tlsproxy_tls_eckey_file = $smtpd_tls_eckey_file
	# tlsproxy_tls_eecdh_grade = $smtpd_tls_eecdh_grade
	# tlsproxy_tls_exclude_ciphers = $smtpd_tls_exclude_ciphers
	# tlsproxy_tls_fingerprint_digest = $smtpd_tls_fingerprint_digest
	# tlsproxy_tls_key_file = $smtpd_tls_key_file
	# tlsproxy_tls_loglevel = $smtpd_tls_loglevel
	# tlsproxy_tls_mandatory_ciphers = $smtpd_tls_mandatory_ciphers
	# tlsproxy_tls_mandatory_exclude_ciphers = $smtpd_tls_mandatory_exclude_ciphers
	# tlsproxy_tls_mandatory_protocols = $smtpd_tls_mandatory_protocols
	# tlsproxy_tls_protocols = $smtpd_tls_protocols
	# tlsproxy_tls_req_ccert = $smtpd_tls_req_ccert
	# tlsproxy_tls_security_level = $smtpd_tls_security_level
	# tlsproxy_tls_session_cache_timeout = $smtpd_tls_session_cache_timeout
	# tlsproxy_use_tls = $smtpd_use_tls
	# tlsproxy_watchdog_timeout = 10s
	##############################################
	conf_tlsproxy_menu() {
		TLSPROXY_MENU=(tlsproxy_enforce_tls \"\$tlsproxy_enforce_tls\"
		tlsproxy_tls_CAfile \"\$tlsproxy_tls_CAfile\"
		tlsproxy_tls_CApath \"\$tlsproxy_tls_CApath\"
		tlsproxy_tls_always_issue_session_ids \"\$tlsproxy_tls_always_issue_session_ids\"
		tlsproxy_tls_ask_ccert \"\$tlsproxy_tls_ask_ccert\"
		tlsproxy_tls_ccert_verifydepth \"\$tlsproxy_tls_ccert_verifydepth\"
		tlsproxy_tls_cert_file \"\$tlsproxy_tls_cert_file\"
		tlsproxy_tls_ciphers \"\$tlsproxy_tls_ciphers\"
		tlsproxy_tls_dcert_file \"\$tlsproxy_tls_dcert_file\"
		tlsproxy_tls_dh1024_param_file \"\$tlsproxy_tls_dh1024_param_file\"
		tlsproxy_tls_dh512_param_file \"\$tlsproxy_tls_dh512_param_file\"
		tlsproxy_tls_dkey_file \"\$tlsproxy_tls_dkey_file\"
		tlsproxy_tls_eccert_file \"\$tlsproxy_tls_eccert_file\"
		tlsproxy_tls_eckey_file \"\$tlsproxy_tls_eckey_file\"
		tlsproxy_tls_eecdh_grade \"\$tlsproxy_tls_eecdh_grade\"
		tlsproxy_tls_exclude_ciphers \"\$tlsproxy_tls_exclude_ciphers\"
		tlsproxy_tls_fingerprint_digest \"\$tlsproxy_tls_fingerprint_digest\"
		tlsproxy_tls_key_file \"\$tlsproxy_tls_key_file\"
		tlsproxy_tls_loglevel \"\$tlsproxy_tls_loglevel\"
		tlsproxy_tls_mandatory_ciphers \"\$tlsproxy_tls_mandatory_ciphers\"
		tlsproxy_tls_mandatory_exclude_ciphers \"\$tlsproxy_tls_mandatory_exclude_ciphers\"
		tlsproxy_tls_mandatory_protocols \"\$tlsproxy_tls_mandatory_protocols\"
		tlsproxy_tls_protocols \"\$tlsproxy_tls_protocols\"
		tlsproxy_tls_req_ccert \"\$tlsproxy_tls_req_ccert\"
		tlsproxy_tls_security_level \"\$tlsproxy_tls_security_level\"
		tlsproxy_tls_session_cache_timeout \"\$tlsproxy_tls_session_cache_timeout\"
		tlsproxy_use_tls \"\$tlsproxy_use_tls\"
		tlsproxy_watchdog_timeout \"\$tlsproxy_watchdog_timeout\"
		postfix \"reload\"
		$gv_Back \"\")
		if [[ ${#argv} == 1 ]] ; then
			menubox -d "$1" "$TLSPROXY_TITLE" "$gv_Menupoint" "$TLSPROXY_MENU"
		else
			menubox "$TLSPROXY_TITLE" "$gv_Menupoint" "$TLSPROXY_MENU"
		fi
	}
	## }}}
	conf_tlsproxy_menu
	while [ "$gv_Auswahl" ] ; do
		case "$gv_Auswahl" in
			HELP*)	script_help tlsproxy_help
				conf_tlsproxy_menu
				;;
			tlsproxy_enforce_tls)
				# = $smtpd_enforce_tls
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_CAfile)
				# = $smtpd_tls_CAfile
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_CApath)
				# = $smtpd_tls_CApath
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_always_issue_session_ids)
				# = $smtpd_tls_always_issue_session_ids
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_ask_ccert)
				# = $smtpd_tls_ask_ccert
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_ccert_verifydepth)
				# = $smtpd_tls_ccert_verifydepth
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_cert_file)
				# = $smtpd_tls_cert_file
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_ciphers)
				# = $smtpd_tls_ciphers
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_dcert_file)
				# = $smtpd_tls_dcert_file
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_dh1024_param_file)
				# = $smtpd_tls_dh1024_param_file
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_dh512_param_file)
				# = $smtpd_tls_dh512_param_file
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_dkey_file)
				# = $smtpd_tls_dkey_file
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_eccert_file)
				# = $smtpd_tls_eccert_file
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_eckey_file)
				# = $smtpd_tls_eckey_file
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_eecdh_grade)
				# = $smtpd_tls_eecdh_grade
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_exclude_ciphers)
				# = $smtpd_tls_exclude_ciphers
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_fingerprint_digest)
				# = $smtpd_tls_fingerprint_digest
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_key_file)
				# = $smtpd_tls_key_file
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_loglevel)
				# = $smtpd_tls_loglevel
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_mandatory_ciphers)
				# = $smtpd_tls_mandatory_ciphers
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_mandatory_exclude_ciphers)
				# = $smtpd_tls_mandatory_exclude_ciphers
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_mandatory_protocols)
				# = $smtpd_tls_mandatory_protocols
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_protocols)
				# = $smtpd_tls_protocols
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_req_ccert)
				# = $smtpd_tls_req_ccert
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_security_level)
				# = $smtpd_tls_security_level
				conf_tlsproxy_menu
				;;
			tlsproxy_tls_session_cache_timeout)
				# = $smtpd_tls_session_cache_timeout
				conf_tlsproxy_menu
				;;
			tlsproxy_use_tls)
				# = $smtpd_use_tls
				conf_tlsproxy_menu
				;;
			tlsproxy_watchdog_timeout)
				# = 10s
				conf_tlsproxy_menu
				;;
			postfix)
				# postfix, Konfiguration neu einlesen
				postfix_start_reload
				break
				;;
			$gv_Back)	break
				;;
		esac
	done
}
#}}}
### Modeline {{{
### vim:ft=zsh:foldmethod=marker
### vim:set ts=4:                                                                               
### }}}
