# Funktion relay_domains_table{{{
#
relay_domains_table() {
	FILE="$1"
	autoload -U no_host_or_domain_msg
# Funktion relay_domain_menue{{{
relay_domain_menue() {
	RELAY_DOMAIN_MENU=$(gettext 'Rechner/Domain "$ADR" $gv_Save "" $gv_Back ""')
	menubox "$TABLE_TITLE" "$gv_Menupoint" "$RELAY_DOMAIN_MENU"
}
#}}}
# Funktion relay_domain_aendern{{{
#
relay_domain_aendern() {
relay_domain_menue
while [ "$gv_Auswahl" ] ; do
	case "$gv_Auswahl" in
		HELP*)	script_help "$TAB_HELP"
			relay_domain_menue
			;;
		Rechner*|Host*)
			# Hosts/Domains eingeben{{{
			HOST_DOMAIN_MSG=$(gettext 'Geben Sie den Namen eines Rechners oder einer Domain ein (Bsp. host1.domain.de | domain.de).')
			inputbox "TABLE_TITLE" "$HOST_DOMAIN_MSG" "$ADR"
			if [ "$gv_Auswahl" ] ; then
				ADR="$gv_Auswahl"
			else
				unset -- ADR
				no_input_msg
			fi
			#}}}
			relay_domain_menue
			;;
		$gv_Save)
			# Einstellungen speichern{{{
			#
			if [ "$ADR" ] ; then
				if [ "$AENDERN_ADR" ] ; then
					sed -e "s#^${AENDERN_ADR}.*#${ADR}	:#" $FILE >$FILE$$
					mv $FILE$$ $FILE
				else
					grep -v "^${ADR}[[:space:]]" $FILE >$FILE$$
					>> $FILE$$ <<< "$ADR	:"
					mv $FILE$$ $FILE
				fi
			else
				no_host_or_domain_msg
			fi
			#}}}
			break
			;;
		$gv_Back)	break
			;;
	esac
done
}
#}}}
#
tabellen_menue
while [ "$gv_Auswahl" ] ; do
	case "$gv_Auswahl" in
		HELP*)	script_help tab_help
			tabellen_menue
			;;
		$gv_Display)
			# Ansicht der Einträge
			tab_ansicht
			tabellen_menue
			;;
		$gv_Create)
			# Werte anlegen
			unset -- ADR AENDERN_ADR
			relay_domain_aendern
			tabellen_menue
			;;
		$gv_Change)
			# Einträge verändern{{{
			key_value "$FILE"
			if [ "$AUSWAHL" ] ; then
				CHANGE_MENU=($AUSWAHL)
				menubox "$TABLE_TITLE" "$TABLE_ENTRY_MSG" "$CHANGE_MENU"
				while [ "$gv_Auswahl" ] ; do
					case "$gv_Auswahl" in
						HELP*)	script_help tab_wert_help
							menubox "$TABLE_TITLE" "$TABLE_ENTRY_MSG" "$CHANGE_MENU"
							;;
						*)	#
							# Auswahl aendern
							ADR=${${gv_Auswahl}[1]}
							AENDERN_ADR="$ADR"
							relay_domain_aendern
							break
							;;
					esac
				done
			else
				no_entry_msg
			fi
			#}}}
			tabellen_menue
			;;
		$gv_Delete)
			# Eintraege loeschen{{{
			key_value "$FILE"
			if [ "$AUSWAHL_MULTI" ] ; then
				DEL_MENU=($AUSWAHL_MULTI)
				U_OPT=no
				checklist "$TABLE_TITLE" "$gv_Delete_MSG" "$DEL_MENU"
				while [ "$gv_Auswahl" ] ; do
					case "$gv_Auswahl" in
						HELP*)	script_help kwpostfix_del_help
							U_OPT=no
							checklist "$TABLE_TITLE" "$gv_Delete_MSG" "$DEL_MENU"
							;;	
						*)	# Löschen
							while read ADRESS ; do
								grep -v "^${ADRESS// /.*}" $FILE >$FILE$$
								mv $FILE$$ $FILE
							done < $gv_LogFile$$
							break
							;;
					esac
				done
			else
				no_entry_msg
			fi
			#}}}
			tabellen_menue
			;;
		D*)
			# Datenbank neu erzeugen und Postfix anweisen die Einstellungen neu einzulesen
			db_new_reread "$WAS_IST" "$FILE"
			break
			;;
		$gv_Back)	break
			;;
	esac
done
}
#}}}
